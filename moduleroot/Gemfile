#This file is generated by ModuleSync, do not edit.

source ENV['GEM_SOURCE'] || "https://rubygems.org"

def location_from_env(env, default_location = [])
  if location = ENV[env]
    if location =~ /^((?:git|https?)[:@][^#]*)#(.*)/
      [{ :git => $1, :branch => $2, :require => false }]
    elsif location =~ /^file:\/\/(.*)/
      ['>= 0', { :path => File.expand_path($1), :require => false }]
    else
      [location, { :require => false }]
    end
  else
    default_location
  end
end

<%
def build_location(gem)
  tags = []
  tags << "'#{gem['version']}'" if gem['version']
  tags << ":git => '#{gem['git']}'" if gem['git']
  tags << ":branch => '#{gem['branch']}'" if gem['branch']
  tags << ":platforms => #{gem['platforms']}" if gem['platforms']
  ruby_expr = if (gem['ruby-operator'] && gem['ruby-version'])
                " if RUBY_VERSION #{gem['ruby-operator']} '#{gem['ruby-version']}'"
              else
                nil
              end
  if gem['from_env']
    ", *location_from_env('#{gem['from_env']}', [#{tags.join(", ")}])#{ruby_expr}"
  elsif tags.length > 0
    ", #{tags.join(", ")}#{ruby_expr}"
  else
    ruby_expr
  end
end
-%>
<% groups = {} -%>
<% (@configs['required'].keys + ((@configs['optional'] || {}).keys)).uniq.each do |key| -%>
<%   groups[key] = (@configs['required'][key] || []) + ((@configs['optional'] || {})[key] || []) -%>
<% end -%>
<% -%>
<% groups.each do |group, gems| -%>
group <%= group %> do
<%  gems.each do |gem| -%>
  gem '<%= gem['gem'] %>'<%= build_location(gem) %>
<%  end -%>
end
<% end -%>

gem 'facter', *location_from_env('FACTER_GEM_VERSION')
gem 'puppet', *location_from_env('PUPPET_GEM_VERSION')

if File.exists? "#{__FILE__}.local"
  eval(File.read("#{__FILE__}.local"), binding)
end
